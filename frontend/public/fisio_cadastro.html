<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Fisioterapeuta</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }

    .page {
      max-width: 640px;
      margin: 40px auto;
      padding: 0 16px;
    }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 8px;
    }

    p.sub {
      margin-top: 0;
      color: #6b7280;
      font-size: 0.95rem;
      margin-bottom: 24px;
    }

    .field {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #4b5563;
    }

    input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
    }

    .btn-primary {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #ffffff;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .msg {
      margin-top: 16px;
      font-size: 0.9rem;
    }

    .msg.ok {
      color: #16a34a;
    }

    .msg.err {
      color: #dc2626;
    }
  </style>
</head>

<body>
  <div class="page">
    <h1>Cadastrar fisioterapeuta</h1>
    <p class="sub">
      Preencha os dados abaixo para registrar um novo fisioterapeuta na plataforma.
    </p>

    <div class="field">
      <label for="nome">Nome completo</label>
      <input type="text" id="nome" />
    </div>

    <div class="field">
      <label for="cpf">CPF</label>
      <input type="text" id="cpf" />
    </div>

    <div class="field">
      <label for="registro">Registro profissional (CREFITO)</label>
      <input type="text" id="registro" />
    </div>

    <div class="field">
      <label for="email">E-mail</label>
      <input type="email" id="email" />
    </div>

    <div class="field">
      <label for="cnpj">CNPJ da clínica (opcional)</label>
      <input type="text" id="cnpj" />
    </div>

    <div class="field">
      <label for="senha">Senha para acesso</label>
      <input type="password" id="senha" />
    </div>

    <button class="btn-primary" onclick="cadastrar()">Cadastrar fisioterapeuta</button>

    <div id="mensagem" class="msg"></div>
  </div>

  <script>
    window.API_BASE = window.API_BASE || "http://127.0.0.1:8000/api";
    var API_BASE = window.API_BASE;

    async function cadastrar() {
      const nome = document.getElementById("nome").value.trim();
      const cpf = document.getElementById("cpf").value.trim();
      const registro = document.getElementById("registro").value.trim();
      const email = document.getElementById("email").value.trim();
      const cnpj = document.getElementById("cnpj").value.trim();
      const senha = document.getElementById("senha").value.trim();
      const msgEl = document.getElementById("mensagem");

      msgEl.textContent = "";
      msgEl.className = "msg";

      if (!nome || !cpf || !registro || !email || !senha) {
        msgEl.textContent = "Preencha todos os campos obrigatórios (incluindo senha).";
        msgEl.classList.add("err");
        return;
      }

      const body = {
        nome,
        cpf,
        registro,
        email,
        cnpj,
        senha,
      };

      try {
        const resp = await fetch(`${API_BASE}/fisioterapeutas`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        const data = await resp.json();

        if (!resp.ok) {
          console.error("Erro ao cadastrar fisioterapeuta:", data);
          msgEl.textContent = Array.isArray(data.detail)
            ? data.detail.join(" | ")
            : (data.detail || "Erro ao cadastrar.");
          msgEl.classList.add("err");
          return;
        }

        msgEl.textContent = "Fisioterapeuta cadastrado com sucesso!";
        msgEl.classList.add("ok");

        // document.querySelectorAll("input").forEach(i => i.value = "");
      } catch (err) {
        console.error("Erro inesperado:", err);
        msgEl.textContent = "Erro inesperado ao cadastrar (veja o console).";
        msgEl.classList.add("err");
      }
    }
  </script>
</body>

</html>